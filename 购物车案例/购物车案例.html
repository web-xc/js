<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´­ç‰©è½¦æ¡ˆä¾‹</title>
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container" id="app">
        <!-- é¡¶éƒ¨banner -->
        <div class="banner-box"><img src="http://autumnfish.cn/static/fruit.jpg" alt="" /></div>
        <!-- é¢åŒ…å±‘ -->
        <div class="breadcrumb">
          <span>ğŸ </span>
          /
          <span>è´­ç‰©è½¦</span>
        </div>
        <!-- è´­ç‰©è½¦ä¸»ä½“ -->
        <div class="main">
          <div class="table">
            <!-- å¤´éƒ¨ -->
            <div class="thead">
              <div class="tr">
                <div class="th">é€‰ä¸­</div>
                <div class="th th-pic">å›¾ç‰‡</div>
                <div class="th">å•ä»·</div>
                <div class="th num-th">ä¸ªæ•°</div>
                <div class="th">å°è®¡</div>
                <div class="th">æ“ä½œ</div>
              </div>
            </div>
            <!-- èº«ä½“ -->
            <div class="tbody">
              <!-- æ¸²æŸ“éœ€è¦çš„è¡Œ -->
              <!-- 
                <div class="tr">
                <div class="td"><input type="checkbox" checked /></div>
                <div class="td"><img src="http://autumnfish.cn/static/ç«é¾™æœ.png" alt="" /></div>
                <div class="td">6</div>
                <div class="td">
                  <div class="my-input-number">
                    <button class="decrease"> - </button>
                    <span class="my-input">2</span>
                    <button class="increase"> + </button>
                  </div>
                </div>
                <div class="td">12</div>
                <div class="td"><button class="del">åˆ é™¤</button></div>
              </div> 
            -->
            </div>
          </div>
          <!-- åº•éƒ¨ -->
          <div class="bottom">
            <!-- å…¨é€‰ -->
            <label class="check-all">
              <input type="checkbox" />
              å…¨é€‰
            </label>
            <div class="right-box">
              <!-- æ‰€æœ‰å•†å“æ€»ä»· -->
              <span class="price-box">æ€»ä»·&nbsp;&nbsp;:&nbsp;&nbsp;Â¥&nbsp;<span class="price">24</span></span>
              <!-- ç»“ç®—æŒ‰é’® -->
              <button class="button pay">ç»“ç®—( 6 )</button>
            </div>
          </div>
        </div>
        <!-- ç©ºè½¦ -->
        <div class="empty" style="display: none;">ğŸ›’ç©ºç©ºå¦‚ä¹Ÿ</div>
      </div>
    <script>
        let data = [
            {
                id: 1,
                icon: 'http://autumnfish.cn/static/ç«é¾™æœ.png',
                isChecked: true,
                num: 2,
                price: 6,
            },
            {
                id: 2,
                icon: 'http://autumnfish.cn/static/è”æ.png',
                isChecked: false,
                num: 7,
                price: 20,
            },
            {
                id: 3,
                icon: 'http://autumnfish.cn/static/æ¦´è².png',
                isChecked: false,
                num: 3,
                price: 40,
            },
            {
                id: 4,
                icon: 'http://autumnfish.cn/static/é¸­æ¢¨.png',
                isChecked: true,
                num: 10,
                price: 3,
            },
            {
                id: 5,
                icon: 'http://autumnfish.cn/static/æ¨±æ¡ƒ.png',
                isChecked: false,
                num: 20,
                price: 34,
            },
        ]
        // 1. æ¸²æŸ“é¡µé¢HTMLç»“æ„
        let tbody = document.querySelector('.tbody')
        let btncheck = document.querySelector('.check-all input')
        let del = document.querySelector('.del')
        function fn() {
          let tb = data.map((item, index) => {
            let {id, icon, isChecked, num, price} = item
            return `
             <div class="tr" data-id="${index}">
                 <div class="td"><input type="checkbox" ${isChecked ? 'checked' : ''} /></div>
                 <div class="td"><img src="${icon}" alt="" /></div>
                 <div class="td">${price}</div>
                 <div class="td">
                   <div class="my-input-number">
                     <button class="decrease"> - </button>
                     <span class="my-input">${num}</span>
                     <button class="increase"> + </button>
                   </div>
                 </div>
                 <div class="td">${price * num}</div>
                 <div class="td"><button class="button del">åˆ é™¤</button></div>
              </div>`
            })
            // mapè¿”å›çš„æ•°ç»„æ‰€ä»¥ç”¨joinè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ¸²æŸ“åˆ°é¡µé¢
            tbody.innerHTML = tb.join('')

            // å…¨é€‰æŒ‰é’®è®¾ç½®
            btncheck.checked = data.every(item => item.isChecked == true)

            // æ€»ä»·æ¨¡å— åªé€‰å‹¾é€‰çš„å•†å“
            let checkAll = data.filter(item => item.isChecked)
            // console.log(checkAll) // ç­›é€‰å‡ºæ¥çš„æ•°ç»„å¯¹è±¡

            // ç­›é€‰çš„å¯¹è±¡ç”¨reduceç´¯è®¡å™¨è®¡ç®—æ€»ä»·
            let zj = checkAll.reduce((prev, item) => prev + item.price * item.num, 0)
            document.querySelector('.price-box .price').innerHTML = zj.toFixed(2)

            // ç­›é€‰çš„å¯¹è±¡è®¡ç®—æœ‰å¤šå°‘ä»¶ä¸œè¥¿
            let jiesuan = checkAll.reduce((prev, item) => prev + item.num, 0)
            document.querySelector('.pay').innerHTML = `ç»“ç®—(${jiesuan})`

            // å¦‚æœè´­ç‰©è½¦ä¸ºç©º åˆ™åº•éƒ¨æ˜¾ç¤ºå‡ºæ¥
            let shopping = document.querySelector('.empty')
            shopping.style.display = data.length == 0 ? 'block' : 'none'
        }
        fn()

        // 2. äº‹ä»¶å§”æ‰˜åš: åˆ é™¤ã€å¢åŠ ã€å…¨é€‰ã€åˆ é™¤ã€æ•°é‡ä¸šåŠ¡
        tbody.addEventListener('click', function (e) {
          let id = e.target.parentNode.parentNode.dataset.id
          // åˆ é™¤æ“ä½œ
          if (e.target.className == 'del') {
            alert()
            data.splice(id, 1)
            fn() // é‡æ–°æ¸²æŸ“æ•°ç»„ç”Ÿæˆé¡µé¢æ•°æ®
          }

          // å°æŒ‰é’®å…¨é€‰å å‹¾é€‰å…¨é€‰æŒ‰é’®
          if (e.target.className == 'INPUT') {
            data[id].isChecked = e.target.checked
            fn()
          }
          
          // å¢åŠ å•†å“æ•°é‡
          if (e.target.className == 'increase') {
            let ids = e.target.parentNode.parentNode.parentNode.dataset.id
            data[ids].num++
            fn()
          }

          // åˆ é™¤å•†å“æ•°é‡
          if (e.target.className == 'decrease') {
            let ids = e.target.parentNode.parentNode.parentNode.dataset.id
            if (data[ids].num <= 1) {
                data[ids].num = 1
            } else {
              data[ids].num--
              fn()
            }
          }
        })

        // 3. å…¨é€‰åé€‰æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        btncheck.addEventListener('click', function () {
          data.forEach(item => item.isChecked = this.checked)
          fn()
        })
    </script>
</body>
</html>